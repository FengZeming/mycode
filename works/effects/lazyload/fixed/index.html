<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>瀑布流_懒加载_固定宽度</title>
		<link rel="stylesheet" type="text/css" href="style.css" />
	</head>

	<body>
		<div id="js-box" class="waterfall-box">
			<ul class="list-box">
				<!--动态加载-->
			</ul>
			<div class="load hide">
				正在加载
			</div>
		</div>
		<script src="http://apps.bdimg.com/libs/jquery/1.11.3/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../../resource/js/class.js" ></script>
		<script src="index.js"></script>
		<script type="text/javascript">
			var curPage = 1,
				perPageCount = 20;
			var wf = new WaterFall({
				boxEl: '#js-box',
				itemW: 236,
				distW: 16,
				handler: function() {
					var self = this;
					getData(function(data) {
						self.start(renderData(data));
					});
				}
			});

			function getData(callBack) {
				$.ajax({
					url: 'http://platform.sina.com.cn/slide/album_tech',
					type: 'get',
					dataType: 'jsonp',
					jsonp: "jsoncallback",
					data: {
						app_key: '1271687855',
						format: 'json',
						size: 'img',
						num: perPageCount,
						page: curPage
					},
					success: function(ret) {
						if (ret.status.code == 0) {
							callBack(ret.data);
							curPage++;
						}
					}
				})
			}
			function renderData(items) {
				var tpl = '',
					$nodes;
				for (var i = 0; i < items.length; i++) {
					tpl += '<li class="item">';
					tpl += ' <a href="#" class="link"><img src="' + items[i].img_url + '" alt=""></a>';
					tpl += ' <h4 class="header">' + items[i].short_name + '</h4>';
					tpl += '<p class="desp">' + items[i].short_intro + '</p>';
					tpl += '</li>';
				}
				$nodes = $(tpl);
				return $nodes;
			}
		</script>

	</body>

</html>